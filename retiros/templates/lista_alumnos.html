{% extends "base.html" %}

{% block title %}
Alumnos - {{ grado.nombre }}
{% endblock %}

{% block content %}

<!-- ENCABEZADO -->
<div class="mb-4">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2">
        <div>
            <h2 class="fw-bold mb-1">
                {{ grado.nombre }}
            </h2>
            <small class="text-muted">
                {{ cantidad }} alumnos activos
            </small>
        </div>
    </div>
</div>

<!-- BUSCADOR -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
        <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
                üîé
            </span>
            <input 
                type="text" 
                id="buscadorAlumno"
                class="form-control border-start-0"
                placeholder="Buscar alumno..."
            >
        </div>
    </div>
</div>

<form method="post" action="{% url 'crear_retiros_masivos' %}">
{% csrf_token %}

<div class="card border-0 shadow-sm">
    <div class="table-responsive">

        <table class="table table-striped align-middle table-hover mb-0">

            <thead class="table-light">
                <tr>
                    <th style="width:50px;"></th>
                    <th>Alumno</th>
                    <th class="text-center">Estado</th>
                    <th class="text-end">Acci√≥n</th>
                </tr>
            </thead>

            <tbody id="tablaAlumnos">

                {% for alumno in alumnos %}
                <tr class="fila-alumno">

                    <td>
                        {% if not alumno.tiene_retiro %}
                            <input type="checkbox"
                                   name="alumnos"
                                   value="{{ alumno.id }}"
                                   class="form-check-input checkAlumno">
                        {% endif %}
                    </td>

                    <td class="fw-semibold">
                        {{ alumno.nombre }}
                    </td>

                    <td class="text-center">
                        {% if alumno.tiene_retiro %}
                            <span class="badge bg-warning-subtle text-warning-emphasis rounded-pill px-3">
                                ‚è≥ Pendiente
                            </span>
                        {% else %}
                            <span class="badge bg-success-subtle text-success-emphasis rounded-pill px-3">
                                Disponible
                            </span>
                        {% endif %}
                    </td>

                    <td class="text-end">
                        {% if alumno.tiene_retiro %}
                            <button class="btn btn-warning btn-sm rounded-pill" disabled>
                                Ya avisado
                            </button>
                        {% else %}
                            <a href="{% url 'crear_retiro' alumno.id %}"
                               class="btn btn-danger btn-sm rounded-pill px-3">
                                Avisar
                            </a>
                        {% endif %}
                    </td>

                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center py-4 text-muted">
                        No hay alumnos registrados en este grado.
                    </td>
                </tr>
                {% endfor %}

            </tbody>

        </table>

    </div>
</div>

<!-- BOT√ìN MASIVO -->
<div class="text-center mt-4">
    <button type="submit" class="btn btn-danger rounded-pill px-4">
        üö® Avisar retiros seleccionados
    </button>
</div>

</form>

<div class="text-center mt-4">
    <a href="{% url 'lista_grados' grado.nivel.id %}"
       class="text-muted text-decoration-none small">
        ‚Üê Volver
    </a>
</div>

{% endblock %}
